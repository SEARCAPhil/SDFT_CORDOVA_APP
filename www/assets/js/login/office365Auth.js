!function(t){var o={};function a(n){if(o[n])return o[n].exports;var e=o[n]={i:n,l:!1,exports:{}};return t[n].call(e.exports,e,e.exports,a),e.l=!0,e.exports}a.m=t,a.c=o,a.d=function(n,e,t){a.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:t})},a.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},a.t=function(e,n){if(1&n&&(e=a(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(a.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)a.d(t,o,function(n){return e[n]}.bind(null,o));return t},a.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return a.d(e,"a",e),e},a.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},a.p="",a(a.s="./src/assets/js/login/office365Auth.js")}({"./src/assets/js/login/office365Auth.js":
/*!**********************************************!*\
  !*** ./src/assets/js/login/office365Auth.js ***!
  \**********************************************/
/*! no static exports found */function(module,exports){eval("function _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\n(function (window, document, undefined) {\n  \"use strict\";\n\n  var profile_data = {}; // ADAL CONFIGURATION\n  // Change default value with your default AD configuration\n\n  window.adalConfig = {\n    instance: 'https://login.microsoftonline.com/',\n    tenant: 'searca.org',\n    //COMMON OR YOUR TENANT ID\n    clientId: 'f121bfba-0b54-4acf-8912-39aae2d7feaf',\n    //This is your client ID\n    redirectUri: \"http://localhost/dts/www/login.html\",\n    //This is your redirect URI\n    cacheLocation: 'localStorage',\n    callback: userSignedIn,\n    popUp: true,\n    endpoints: {\n      \"https://graph.microsoft.com\": \"https://graph.microsoft.com\"\n    } // adal global instance\n\n  };\n  window.AuthenticationContext = AuthenticationContext; // adal instance\n\n  window.ADAL = new window.AuthenticationContext(window.adalConfig);\n  window.ADAL.handleWindowCallback(); // phonegap settings\n\n  if (document.URL.indexOf('http://') === -1 && document.URL.indexOf('https://') === -1) {\n    delete window.open; // This restores the default browser\n  }\n  /*-------------------------------------------------\n  | Save details in to device\n  |--------------------------------------------------*/\n\n\n  var __save_token_to_storage = function __save_token_to_storage(token) {\n    window.localStorage.setItem('token', token);\n  };\n\n  var __save_user_details_to_storage = function __save_user_details_to_storage(data) {\n    window.localStorage.setItem('cached_full_name', data.details.full_name);\n    window.localStorage.setItem('cached_first_name', data.details.first_name);\n    window.localStorage.setItem('cached_last_name', data.details.last_name);\n    window.localStorage.setItem('cached_department', data.details.department);\n    window.localStorage.setItem('cached_alias', data.details.alias);\n    window.localStorage.setItem('cached_position', data.details.position);\n    window.localStorage.setItem('cached_uid', data.details.uid);\n    window.localStorage.setItem('cached_user_data', JSON.stringify(data));\n  };\n\n  var office365Login = function office365Login() {\n    // e.target.disabled = 'disabled'\n    window.ADAL.login();\n    $.mobile.loading('show');\n  }; // adal error\n\n\n  var authError = function authError() {\n    $.mobile.loading('hide');\n    alert('Unable to authenticate. Please try again later.');\n  }; // login via API\n\n\n  var loginOnPremiseServer = function loginOnPremiseServer(data) {\n    return new Promise(function (resolve, reject) {\n      var XHR = new XMLHttpRequest();\n      var payload = {\n        url: \"\".concat(__config.endpoint.url, \"authentication/office365Auth.php\"),\n        method: 'POST',\n        body: JSON.stringify({\n          data: data\n        })\n      };\n      XHR.open(payload.method, payload.url);\n      XHR.addEventListener('load', function (res) {\n        var json = res.currentTarget.responseText;\n        var data = JSON.parse(json);\n\n        try {\n          resolve(data);\n        } catch (err) {\n          reject(err);\n        }\n      });\n      XHR.send(payload.body);\n    });\n  };\n\n  var loginOnPremise = function loginOnPremise(data) {\n    profile_data = {\n      full_name: data.displayName,\n      first_name: data.givenName,\n      id: data.id,\n      email: data.mail,\n      office: data.officeLocation,\n      department: data.department,\n      position: data.jobTitle,\n      surname: data.surname,\n      token: data.id // authenticate to remote server\n\n    };\n    loginOnPremiseServer(profile_data).then(function (json) {\n      $.mobile.loading('hide'); // save to storage\n\n      __save_token_to_storage(json.token);\n\n      __save_user_details_to_storage(json); // redirect\n\n\n      setTimeout(function () {\n        window.location = 'index.html';\n      }, 700);\n    })[\"catch\"](function (err) {\n      console.log(err);\n      $.mobile.loading('hide');\n      authError();\n      document.querySelector('.btn-office365').removeAttribute('disabled');\n    });\n  }; // get msgraph\n\n\n  var getGraph = function getGraph(token) {\n    fetch('https://graph.microsoft.com/beta/me/', {\n      headers: {\n        'Authorization': 'Bearer ' + token\n      },\n      method: 'GET'\n    }).then(function (response) {\n      return response.json();\n    })[\"catch\"](function (err) {\n      authError();\n    }).then(function (data) {\n      // auth to onpremise\n      if (data.id) {\n        loginOnPremise(data);\n      }\n    });\n  }; // adal callback\n\n\n  function userSignedIn(err, token) {\n    $.mobile.loading('show');\n\n    if (!err) {\n      window.ADAL.acquireToken(\"https://graph.microsoft.com\", function (error, token) {\n        if (token.length) {\n          getGraph(token);\n        } else {\n          authError();\n        }\n      });\n    }\n  } //console\n\n\n  console.log(\"%cUnauthorized Access\", \"color: red; font-size: x-large\");\n  console.log(\"%cDocument Tracking System : You are trying to view the code in console\", \"color: grey\");\n  /*-------------------------------------------------\n  | Make office365 login available to global scope\n  |--------------------------------------------------*/\n\n  if (_typeof(window.sdft) != 'object') window.sdft = {};\n  if (_typeof(window.sdft.user) != 'object') window.sdft.user = {}; //user\n\n  window.sdft.office365Login = office365Login;\n  window.sdft.user = profile_data;\n})(window, document);\n\n//# sourceURL=webpack:///./src/assets/js/login/office365Auth.js?")}});